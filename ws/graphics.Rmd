---
title: "Introduction to grammar of graphics"
author: "Murray Logan"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  html_document:
    code_folding: show
    collapse: no
    df_print: paged
    fig_caption: yes
    fig_height: 4
    fig_width: 4
    highlight: textmate
    theme: spacelab
    toc: yes
    toc_float: yes
    css: ../resources/style.css
  pdf_document:
    df_print: default
    fig_caption: yes
    fig_height: 4
    fig_width: 4
    highlight: tango
    latex_engine: xelatex
    number_sections: yes
    toc_depth: 2
  word_document:
    fig_caption: yes
    fig_height: 4
    fig_width: 4
    highlight: tango
    toc: yes
    toc_depth: 2
output_dir: "docs"
documentclass: article
fontsize: 12pt
mainfont: Arial
mathfont: LiberationMono
monofont: DejaVu Sans Mono
classoption: a4paper
bibliography: ../resources/references.bib
---

```{r setup, include=FALSE, warnings=FALSE, message=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Preparations

Load the necessary libraries

```{r libraries, results='markdown', eval=TRUE, message=FALSE, warning=FALSE}
library(tidyverse) #for data wrangling
library(grid) # grids on plots
library(patchwork)
library(scales) # manipulate color scales, transofmations
library(gridExtra)
```

Base graphics start with base graphics and add components. Isolated instructions to the device.

ggplot built to follow structure and rules of graphics.

Graphics infrastructure
========================

- **layers** of data driven objects
- **coord**inate system
- **scales**
- **faceting**
- **themes**

Scales also applies to colors, legends, etc.
Faceting should be consistent.
Overall theme, color scheme, font.

Motivating data
-----------------

Biochemical Oxygen Demand built in data - Time (days) and demand (mg/l).

```{r, results='markup'}
head(BOD)
summary(BOD)
```

Layers
==========

- **layers** of data driven objects
    - **geom**etric objects to represent data
    - **stat**istical methods to summarize the data
    - **mapping** of aesthetics
    - **position** control

## geom_point

Rmarkdown will embed plots into the document. Can change figure parameters in options.

Can define fig.width and fig.height in chunk options. Also out.width in pixels. Why define both? Fonts, dots, etc. are in proportion to the zoom and out.width is the 'zoom' or scale. Also might want to specify resolution. For html, dpi = 72 is fine (lower dpi = smaller file size but NOT for printing). Word docs or standalone image (presentation, publications, etc.) much higher dpi like 600.

```{r scatterplot of BOD, fig.width=5, fig.height=5, out.width=400, dpi = 300}
ggplot(data = BOD, 
       map = aes(y = demand, x = Time)) +
  geom_point() +
  geom_line()
```
```{r another ggplot}
# OR
g1 <- ggplot() +
  geom_point(data = BOD, aes(y = demand, x = Time)) # first argument geoms expect is NOT data though, expects aes() first

ggsave(filename = '../ws/outputs/figures/fig1.png', g1, width = 5, height = 5, dpi = 600)
```

> Follow golden ratio for aesthetically pleasing graphics.

Use patchwork package for multiplots. Makes sure the axes line up!

ggplot does not like multiplots... cowplots package tends to break. patchwork bit more stable.

```{r patchwork}
g2 <- ggplot() +
  geom_line(data = BOD, aes(y = demand, x = Time))
g2

g1 + g2 # sideways 
g1 / g2 # vertical facet
g1 / (g2 + g1)

(g1 + geom_line(data = BOD, aes(y = demand, x = Time, color = demand))) / (g2 + g1) # axes line up even with legend
```

Primary geometric objects
===========================

`geom_bar`
------------


`geom_boxplot`
----------------


`geom_line`
-------------


`geom_point`
------------


`geom_smooth`
------------

`geom_polygon`
----------------

`geom_tile`
----------------

`geom_raster`
----------------

Secondary geometric objects
============================

`geom_errorbar`
------------------

`geom_pointrange`
------------------

Coordinate systems
====================


Scales
==========

`scale_x_` and `scale_y_`
----------------------------

Other scales
---------------

- **size** of points (thickness of lines)
- **shape** of points
- **linetype** of lines
- **color** of lines or points
- **fill** of shapes

`scale_size`
----------------

`scale_shape`
----------------

`scale_linetype`
----------------

`scale_fill` and `scale_color`
-------------------------------

Facets
==========

Themes
==========

`theme_classic`
----------------

`theme_bw`
----------------

`theme_grey`
----------------

`theme_minimal`
----------------

`theme_linedraw`
----------------

Practice
===========
